/* ###*B*###
 *
 * ERIKA Enterprise - a tiny RTOS for small microcontrollers
 * 
 * Copyright (C) 2002-2018 Evidence Srl
 * 
 * This file is part of ERIKA Enterprise.
 * 
 * See LICENSE file.
 *
 * ###*E*### */

/***************************************************************************
 *
 * This file is generated by RT-Druid.
 * Please do not modify it.
 *
 **************************************************************************/

#include <ee_conf.h>


/***************************************************************************
 *
 * Declare tasks
 *
 **************************************************************************/
DeclareTask(MileageTask);
DeclareTask(DisplayTask);


/***************************************************************************
 *
 * Declare ISR
 *
 **************************************************************************/
ISR2(ButtonISR);


/***************************************************************************
 *
 * Declare Idle Hooks
 *
 **************************************************************************/
extern void idle_hook (void);


/***************************************************************************
 *
 * Alarms Callbacks
 *
 **************************************************************************/


/***************************************************************************
 *
 * Reserve stack
 *
 **************************************************************************/
VAR(OsEE_stack, OS_STACK)
  osEE_task_stack_1[OSEE_STACK_WORD_LENGHT(osEE_task_stack_1_StackSize)];


VAR(OsEE_stack, OS_STACK)
  osEE_task_stack_2[OSEE_STACK_WORD_LENGHT(osEE_task_stack_2_StackSize)];


/***************************************************************************
 *
 * Init Stack Control Block
 *
 **************************************************************************/
VAR(OsEE_SCB, OS_VAR_INIT) scb_array[OSEE_STACK_ARRAY_SIZE] =
{
  { /* .p_tos = */  OSEE_STACK_TOS(osEE_task_stack_1) },
  { /* .p_tos = */  OSEE_STACK_TOS(osEE_task_stack_2) },
  { /* .p_tos = */  NULL } 
};


/***************************************************************************
 *
 * Init Stack Descriptor Block
 *
 **************************************************************************/
VAR(OsEE_SDB, OS_CONST) sdb_array[OSEE_STACK_ARRAY_SIZE] =
{
  {
    /* .p_bos = */      OSEE_STACK_BOS(osEE_task_stack_1),
    /* .stack_size = */ osEE_task_stack_1_StackSize
  },
  {
    /* .p_bos = */      OSEE_STACK_BOS(osEE_task_stack_2),
    /* .stack_size = */ osEE_task_stack_2_StackSize
  },
  {
    /* .p_bos = */      NULL,
    /* .stack_size = */ 0
  }
};


/***************************************************************************
 *
 * Init Tasks Control Block
 *
 **************************************************************************/
VAR(OsEE_TCB, OS_VAR_INIT)
  tcb_array[OSEE_TASK_ARRAY_SIZE + OSEE_USED_CORES] =
{
  {
    /* .current_num_of_act = */ 0U,
    /* .current_prio       = */ 128U,
    /* .status             = */ SUSPENDED,
    /* .p_first_mtx        = */ NULL,
    /* .wait_mask          = */ 0U,
    /* .event_mask         = */ 0U},
  {
    /* .current_num_of_act = */ 0U,
    /* .current_prio       = */ 128U,
    /* .status             = */ SUSPENDED,
    /* .p_first_mtx        = */ NULL,
    /* .wait_mask          = */ 0U,
    /* .event_mask         = */ 0U},
  {
    /* .current_num_of_act = */ 0U,
    /* .current_prio       = */ 2U,
    /* .status             = */ SUSPENDED,
    /* .p_first_mtx        = */ NULL,
    /* .wait_mask          = */ 0U,
    /* .event_mask         = */ 0U},
  {
    /* .current_num_of_act = */ 0U,
    /* .current_prio       = */ 1U,
    /* .status             = */ SUSPENDED,
    /* .p_first_mtx        = */ NULL,
    /* .wait_mask          = */ 0U,
    /* .event_mask         = */ 0U},
  {
    /* .current_num_of_act = */ 1U,
    /* .current_prio       = */ 0U,
    /* .status             = */ RUNNING,
    /* .p_first_mtx        = */ NULL,
    /* .wait_mask          = */ 0U,
    /* .event_mask         = */ 0U}
};

/***************************************************************************
 *
 * Init Tasks Descriptor Block
 *
 **************************************************************************/
VAR(OsEE_TDB, OS_CONST)
  tdb_array[OSEE_TASK_ARRAY_SIZE + OSEE_USED_CORES] =
{
  {
    /* .hdb = */ {
      /* .p_sdb    = */     &sdb_array[2U],
      /* .p_scb    = */     &scb_array[2U],
    },
    /* .p_tcb          = */ &tcb_array[0U],
    /* .tid            = */ 0U,
    /* .task_type      = */ OSEE_TASK_TYPE_ISR2,
    /* .task_func      = */ osEE_avr8_system_timer_handler,
    /* .ready_prio     = */ 128U,
    /* .dispatch_prio  = */ OSEE_ISR_ALL_PRIO,
    /* .max_num_of_act = */ 1U},
  {
    /* .hdb = */ {
      /* .p_sdb    = */     &sdb_array[2U],
      /* .p_scb    = */     &scb_array[2U],
    },
    /* .p_tcb          = */ &tcb_array[1U],
    /* .tid            = */ 1U,
    /* .task_type      = */ OSEE_TASK_TYPE_ISR2,
    /* .task_func      = */ ButtonISR,
    /* .ready_prio     = */ 128U,
    /* .dispatch_prio  = */ 128U,
    /* .max_num_of_act = */ 1U},
  {
    /* .hdb = */ {
      /* .p_sdb    = */  &sdb_array[0U],
      /* .p_scb    = */  &scb_array[0U]
    },
    /* .p_tcb          = */ &tcb_array[2U],
    /* .tid            = */ 2U,
    /* .task_type      = */ OSEE_TASK_TYPE_EXTENDED,
    /* .task_func      = */ TASK_FUNC(MileageTask),
    /* .ready_prio     = */ 2U,
    /* .dispatch_prio  = */ 127U,
    /* .max_num_of_act = */ 1U},
  {
    /* .hdb = */ {
      /* .p_sdb    = */  &sdb_array[1U],
      /* .p_scb    = */  &scb_array[1U]
    },
    /* .p_tcb          = */ &tcb_array[3U],
    /* .tid            = */ 3U,
    /* .task_type      = */ OSEE_TASK_TYPE_EXTENDED,
    /* .task_func      = */ TASK_FUNC(DisplayTask),
    /* .ready_prio     = */ 1U,
    /* .dispatch_prio  = */ 1U,
    /* .max_num_of_act = */ 1U},
  {
    /* .hdb = */ {
      /* .p_sdb    = */     &sdb_array[2U],
      /* .p_scb    = */     &scb_array[2U]
    },
    /* .p_tcb          = */ &tcb_array[4U],
    /* .tid            = */ 4U,
    /* .task_type      = */ OSEE_TASK_TYPE_IDLE,
    /* .task_func      = */ osEE_idle_hook_wrapper,
    /* .ready_prio     = */ 0U,
    /* .dispatch_prio  = */ 0U,
    /* .max_num_of_act = */ 1U}
};

CONSTP2VAR(OsEE_TDB, OS_CONST, OS_APPL_DATA)
  tdb_ptr_array[OSEE_TASK_ARRAY_SIZE + OSEE_USED_CORES] =
{
  &tdb_array[0U],
  &tdb_array[1U],
  &tdb_array[2U],
  &tdb_array[3U],
  &tdb_array[4U]
};

VAR(OsEE_SN, OS_VAR_INIT)  sn_array[OSEE_SN_ARRAY_SIZE] = {
  {
    /* .p_next = */ &sn_array[1U],
    /* .p_tdb  = */ NULL
  }
,
  {
    /* .p_next = */ &sn_array[2U],
    /* .p_tdb  = */ NULL
  }
,
  {
    /* .p_next = */ &sn_array[3U],
    /* .p_tdb  = */ NULL
  }
,
  {
    /* .p_next = */ NULL,
    /* .p_tdb  = */ NULL
  }
};

VAR(OsEE_MCB, OS_VAR_NO_INIT) res_cb_array[OSEE_RESOURCE_ARRAY_SIZE];

VAR(OsEE_MDB, OS_VAR_INIT) res_db_array[OSEE_RESOURCE_ARRAY_SIZE] = {
  {
    /* .p_res_cb = */ &res_cb_array[0U],
    /* .mtx_prio = */ 2U
  }
};

CONSTP2VAR(OsEE_MDB, OS_CONST, OS_APPL_DATA)
  res_db_ptr_array[OSEE_RESOURCE_ARRAY_SIZE] =
{
  &res_db_array[0U]
};


/***************************************************************************
 *
 * Autostart Task
 *
 **************************************************************************/
CONSTP2VAR(OsEE_TDB, OS_CONST, OS_APPL_DATA)
  tdb_ptr_autostart_Kilometers[2U] =
{
  &tdb_array[2U],
  &tdb_array[3U]
};



VAR(OsEE_autostart_tdb, OS_CONST) osEE_autostart_tdb[3U] =
{
  {
    /* .tdb_ptr_array = */    &tdb_ptr_autostart_Kilometers,
    /* .tdb_array_size  = */  OSEE_ARRAY_ELEMENT_COUNT(tdb_ptr_autostart_Kilometers)
  },
  {
    /* .tdb_ptr_array = */    NULL,
    /* .tdb_array_size  = */  (0U)
  },
  {
    /* .tdb_ptr_array = */    NULL,
    /* .tdb_array_size  = */  (0U)
  }
};

/***************************************************************************
 *
 * Counters
 *
 **************************************************************************/
VAR(OsEE_CounterCB, OS_VAR_NO_INIT)
  counter_cb_array[OSEE_COUNTERS_ARRAY_SIZE];

VAR(OsEE_CounterDB, OS_CONST)
  counter_db_array[OSEE_COUNTERS_ARRAY_SIZE] = {
  {
    /* .p_count_cb      = */ &counter_cb_array[0U],
    /* .info            = */ {
      /* .maxallowedvalue = */ (65535U),
      /* .ticksperbase    = */ (1U),
      /* .mincycle        = */ (1U)
    }
  }

};
CONSTP2VAR(OsEE_CounterDB, OS_CONST, OS_APPL_DATA)
  counter_db_ptr_array[OSEE_COUNTERS_ARRAY_SIZE] =
{
  &counter_db_array[0U]
};

/***************************************************************************
 *
 * Alarms
 *
 **************************************************************************/
VAR(OsEE_AlarmCB, OS_VAR_NO_INIT)
  alarm_cb_array[OSEE_ALARMS_ARRAY_SIZE];

VAR(OsEE_AlarmDB, OS_CONST)
  alarm_db_array[OSEE_ALARMS_ARRAY_SIZE] = {
  {
    /* .p_trigger_cb = */ &alarm_cb_array[0U],
    /* .p_counter_db = */ &counter_db_array[0U],
    /* .action       = */ {
      /* .param      = */   {
        /* .f            = */ NULL,
        /* .p_tdb        = */ &tdb_array[2U],
        /* .p_counter_db = */ NULL,
        /* .mask         = */ 0x2U
      },
      /* .type       = */ OSEE_ACTION_EVENT
    }
  }
};
CONSTP2VAR(OsEE_AlarmDB, OS_CONST, OS_APPL_DATA)
  alarm_db_ptr_array[OSEE_ALARMS_ARRAY_SIZE] =
{
  &alarm_db_array[0]
};

/***************************************************************************
 *
 * Autostart Alarm
 *
 **************************************************************************/
VAR(OsEE_autostart_trigger_info, OS_CONST)
  trigger_autostart_info_Kilometers[1U] =
{
  {
    /* p_trigger_db = */  &alarm_db_array[0U],
    /* increment    = */  (1000U),
    /* cycle        = */  (1000U)
  }
};

VAR(OsEE_autostart_trigger_info, OS_CONST)
  trigger_autostart_info_Miles[1U] =
{
  {
    /* p_trigger_db = */  &alarm_db_array[0U],
    /* increment    = */  (1000U),
    /* cycle        = */  (1000U)
  }
};

VAR(OsEE_autostart_trigger_info, OS_CONST)
  trigger_autostart_info_OSDEFAULTAPPMODE[1U] =
{
  {
    /* p_trigger_db = */  &alarm_db_array[0U],
    /* increment    = */  (1000U),
    /* cycle        = */  (1000U)
  }
};

VAR(OsEE_autostart_trigger, OS_CONST) osEE_autostart_trigger_db[3U] =
{
  {
    /* .tdb_ptr_array = */    &trigger_autostart_info_Kilometers,
    /* .tdb_array_size  = */  OSEE_ARRAY_ELEMENT_COUNT(trigger_autostart_info_Kilometers)
  },
  {
    /* .tdb_ptr_array = */    &trigger_autostart_info_Miles,
    /* .tdb_array_size  = */  OSEE_ARRAY_ELEMENT_COUNT(trigger_autostart_info_Miles)
  },
  {
    /* .tdb_ptr_array = */    &trigger_autostart_info_OSDEFAULTAPPMODE,
    /* .tdb_array_size  = */  OSEE_ARRAY_ELEMENT_COUNT(trigger_autostart_info_OSDEFAULTAPPMODE)
  }
};

/***************************************************************************
 *
 * Init Cpu Control Block
 *
 **************************************************************************/
VAR(OsEE_CCB, OS_VAR_INIT) CCB = {
  /* .p_curr      = */  &tdb_array[4U],
  /* .rq          = */  NULL,
  /* .p_free_sn   = */  &sn_array[0U],
  /* .p_stk_sn    = */  NULL,
  /* .os_status   = */  OSEE_KERNEL_STOPPED,
  /* .app_mode    = */  INVALID_APPMODE,
  /* .last_error  = */  E_OK,
  /* .prev_s_isr_all_status = */ 0U,
  /* .prev_s_isr_os_status  = */ 0U,
  /* .s_isr_all_cnt         = */ 0U,
  /* .s_isr_os_cnt          = */ 0U,
  /* .d_isr_all_cnt         = */ 0U};

/***************************************************************************
 *
 * Init Cpu Descriptor Block
 *
 **************************************************************************/
VAR(OsEE_CDB, OS_CONST) CDB = {
  /* .p_ccb                         = */ &CCB,
  /* .p_idle_hook                   = */ idle_hook,
  /* .p_idle_task                   = */ &tdb_array[4U],
  /* .p_sys_counter_db              = */ &counter_db_array[0U],
  /* .p_autostart_tdb_array         = */ &osEE_autostart_tdb,
  /* .autostart_tdb_array_size      = */ OSEE_ARRAY_ELEMENT_COUNT(osEE_autostart_tdb),
  /* .p_autostart_trigger_array     = */ &osEE_autostart_trigger_db,
  /* .autostart_trigger_array_size  = */ OSEE_ARRAY_ELEMENT_COUNT(osEE_autostart_trigger_db)
};

VAR(OsEE_KCB, OS_VAR_NO_INIT) KCB;

VAR(OsEE_KDB, OS_CONST) KDB = {
  /* .p_kcb              = */ &KCB,
  /* .tdb_ptr_array      = */ &tdb_ptr_array,
  /* .sn_array           = */ &sn_array,
  /* .tdb_array_size     = */ OSEE_ARRAY_ELEMENT_COUNT(tdb_ptr_array),
  /* .sn_array_size      = */ OSEE_ARRAY_ELEMENT_COUNT(sn_array),
  /* .p_res_array        = */ &res_db_ptr_array,
  /* .res_array_size     = */ OSEE_ARRAY_ELEMENT_COUNT(res_db_array),
  /* .p_counter_array    = */ &counter_db_ptr_array,
  /* .counter_array_size = */ OSEE_ARRAY_ELEMENT_COUNT(counter_db_array),
  /* .p_alarm_array      = */ &alarm_db_ptr_array,
  /* .alarm_array_size   = */ OSEE_ARRAY_ELEMENT_COUNT(alarm_db_array)};



/***************************************************************************
 *
 * End
 *
 **************************************************************************/

